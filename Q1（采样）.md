你看到的 **Metropolis–Hastings（MH）** 是一种 **MCMC（马尔可夫链蒙特卡洛）采样算法**。它用来从一个“很难直接抽样”的分布里抽样——最典型的就是 **贝叶斯后验分布**。

---

## 它到底是什么？一句话

**MH = 用“提议一个新值 → 看它有多合理 → 以一定概率接受/拒绝”的方式，构造一条会长期停留在目标分布上的随机序列（链）。**

这条链后面抽到的样本，就可以当作来自目标分布的样本，用来算均值、置信区间等。

---

## 为什么需要它？

很多时候你想采样的分布是：
[
p(x)\propto \text{prior}(x)\times \text{likelihood}(x)
]
它只知道“比例”，**没有简单的标准分布形式**，所以没法像正态分布那样直接 `np.random.normal()` 抽。

MH 的厉害之处是：**不需要知道归一化常数**，只用知道“相对大小”就行。

---

## MH 采样怎么做？（核心步骤）

假设我们想从目标分布 ( \pi(x) ) 采样（比如你的后验）。

1. **当前在 (x)**

2. **提议一个新点 (x')**
   从提议分布 (q(x'|x)) 抽一个候选（比如 “在当前点附近加一点正态噪声”）

3. **算接受率**
   [
   \alpha=\min\left(1,\ \frac{\pi(x'),q(x|x')}{\pi(x),q(x'|x)}\right)
   ]

4. **接受/拒绝**
   生成 (u\sim U(0,1))：

* 若 (u<\alpha)，接受：下一步变成 (x')
* 否则拒绝：下一步还停在 (x)

> 如果你的提议是“对称的”（最常见：(x' = x + \mathcal N(0, s^2))），那么
> (q(x'|x)=q(x|x')) 抵消掉，接受率就简化为：
> [
> \alpha=\min\left(1,\ \frac{\pi(x')}{\pi(x)}\right)
> ]

---

## 直觉怎么理解？

* 如果新点 (x') 在目标分布里“更可能”（(\pi(x')>\pi(x))），**几乎总会接受**。
* 如果新点更差，也**不是完全不接受**，而是“有小概率接受”，这样链才能跳出局部陷阱，不会卡死。

---

## 跟你 notebook 里的关系（对应你在采样什么）

在你的 Q1 里，MH 采样的通常不是 (F)（投票比例），而是 **潜变量 (z)**（实数向量），再用 softmax 变成 (F)。
所以 MH 的 “(x)” 在你那里就是 “这一周所有 active 选手的 (z_t)” 或者“整个赛季的 (z) 矩阵”的某个块。

---

## 你经常会看到的几个术语

* **burn-in（烧入）**：前面一段样本不稳定，丢掉
* **thinning（抽稀）**：每隔几步留一个样本，减少自相关（不是必须，但有时会用）
* **acceptance rate（接受率）**：太低→步子太大；太高→步子太小、走得慢
  常见经验：随机游走 MH 接受率在一个“中等区间”通常更好（不用死抠具体数值，理解趋势就行）

---

如果你把你 notebook 里 **MH 的那段函数（比如 `run_mh_season` / `mh_step`）截图或贴出来**，我可以逐行指给你看：
哪一行是提案 (q)，哪一行在算 (\Delta \log \pi)，哪一行在做 accept/reject，以及你现在的 `step_z / sigma / beta` 分别在影响 MH 的哪部分。
